<html>
    <head>
        <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no'>
        <link href="/font/bootstrap-icons.min.css" rel="stylesheet">
        <link href='/css/bootstrap.min.css' rel='stylesheet'></link>
        <style>
            .custom-container {
                max-width: 400px; 
                margin: auto; 
            }
            /* Apply styles for smaller screens */
            @media (max-width: 700px) {
                .custom-container {
                    max-width: 80%; 
                }
            }
            /* Apply styles for larger screens */
            @media (min-width: 700px) {
                .custom-container {
                  max-width: 50%; 
                }
            }
            button.btn-primary {
                width: 100%;
                background-color: #e8c7c8;
                border-color: #e8c7c8;
                color: black;
                font-weight: 600;
                border-radius: 20px;
                cursor: pointer;
            }
            button.btn-primary:hover {
                width: 100%;
                background-color: #b86d7e;
                border-color: #b86d7e;
                color: black;
            }
        </style>
        <title>Checkout</title>
    </head>

    <body class='bg-light'>

        <div class='container custom-container'>
            <div class='py-5 text-center'>
                <h2>Checkout</h2>
                <p class='lead'>Enter your information below.</p>
            </div>
        </div>

        <div class='container custom-container'>
            <div id='liveAlertPlaceholder'></div>
            <h4 class='mb-3'>Shipping Information</h4>
            <form id='checkout-form' class='was-validated' novalidate>
                <div class='row g-3'>
                    <div class='col-sm-6'>
                        <label for='firstName' class='form-label'>First Name</label>
                        <input type='text' id='firstName' name='firstName' class='form-control' required>
                        <div class='invalid-feedback'>Required</div>
                    </div>
                    <div class='col-sm-6'>
                        <label for='lastName' class='form-label'>Last Name</label>
                        <input type='text' id='lastName' name='lastName' class='form-control' required>
                        <div class='invalid-feedback'>Required</div>
                    </div>
                </div>
                <div class='col-12'>
                    <label for='email' class='form-label'>Email</label>
                    <input type='text' id='email' name='email' class='form-control' placeholder='username@email.com' pattern='[\w.%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}$' required>
                    <div class='invalid-feedback'>Required</div>
                </div>

                <div class='col-sm-12'>
                    <label for='address' class='form-label'>Address</label>
                    <input type='text' id='address' name='address' class='form-control' placeholder='1234 Main St' required>
                    <div class='invalid-feedback'>Required</div>
                </div>

                <div class='row g-3'>
                    <div class='col-sm-6'>
                        <label for='country' class='form-label'>Country</label>
                        <select class='form-select' name='country' required>
                            <option selected disabled value=''>Choose...</option>
                            <option value='United States'>United States</option>
                        </select>
                        <div class='invalid-feedback'>Required</div>
                    </div>
                    <div class='col-sm-6'>
                        <label for='State' class='form-label'>State</label>
                        <select class='form-select' name='state' required>
                            <option selected disabled value=''>Choose...</option>
                            <option value='AL'>AL</option>
                            <option value='AK'>AK</option>
                            <option value='AR'>AR</option>
                            <option value='AZ'>AZ</option>
                            <option value='CA'>CA</option>
                            <option value='CO'>CO</option>
                            <option value='CT'>CT</option>
                            <option value='DC'>DC</option>
                            <option value='DE'>DE</option>
                            <option value='FL'>FL</option>
                            <option value='GA'>GA</option>
                            <option value='HI'>HI</option>
                            <option value='IA'>IA</option>
                            <option value='ID'>ID</option>
                            <option value='IL'>IL</option>
                            <option value='IN'>IN</option>
                            <option value='KS'>KS</option>
                            <option value='KY'>KY</option>
                            <option value='LA'>LA</option>
                            <option value='MA'>MA</option>
                            <option value='MD'>MD</option>
                            <option value='ME'>ME</option>
                            <option value='MI'>MI</option>
                            <option value='MN'>MN</option>
                            <option value='MO'>MO</option>
                            <option value='MS'>MS</option>
                            <option value='MT'>MT</option>
                            <option value='NC'>NC</option>
                            <option value='ND'>ND</option>
                            <option value='NE'>NE</option>
                            <option value='NH'>NH</option>
                            <option value='NJ'>NJ</option>
                            <option value='NM'>NM</option>
                            <option value='NV'>NV</option>
                            <option value='NY'>NY</option>
                            <option value='OH'>OH</option>
                            <option value='OK'>OK</option>
                            <option value='OR'>OR</option>
                            <option value='PA'>PA</option>
                            <option value='RI'>RI</option>
                            <option value='SC'>SC</option>
                            <option value='SD'>SD</option>
                            <option value='TN'>TN</option>
                            <option value='TX'>TX</option>
                            <option value='UT'>UT</option>
                            <option value='VA'>VA</option>
                            <option value='VT'>VT</option>
                            <option value='WA'>WA</option>
                            <option value='WI'>WI</option>
                            <option value='WV'>WV</option>
                            <option value='WY'>WY</option>
                        </select>
                        <div class='invalid-feedback'>Required</div>
                    </div>
                </div>

                <div class='row g-3'>
                    <div class='col-sm-6'>
                        <label for='city' class='form-label'>City</label>
                        <input type='text' id='city' name='city' class='form-control' required>
                        <div class='invalid-feedback'>Required</div>
                    </div>
                    <div class='col-sm-6'>
                        <label for='zip' class='form-label'>Zip Code</label>
                        <input type='text' id='zip' name='zip' class='form-control' placeholder='12345' pattern='^\d{5}(?:-\d{4})?$'required>
                        <div class='invalid-feedback'>Required</div>
                    </div>
                </div>

                <hr class='my-4'>

                <h4 class='mb-3'>Payment</h4>
                <div class='col-sm-12'>
                    <label for='cc' class='form-label'>Credit Card Number</label>
                    <input type='text' id='cc' name='cc' class='form-control' pattern='\b\d{4}(| |-)\d{4}\1\d{4}\1\d{4}\b' required>
                    <div class='invalid-feedback'>Required</div>
                </div>
                
                <div class='row g-3'>
                    <div class='col-sm-6'>
                        <label for='exp' class='form-label'>Expiration</label>
                        <input type='text' id='exp' name='exp' class='form-control' placeholder='01/2023' pattern='(0?[1-9]|1[0-2])\/\d{4}' required>
                        <div class='invalid-feedback'>Required</div>
                    </div>
                    <div class='col-sm-6'>
                        <label for='cvv' class='form-label'>CVV</label>
                        <input type='text' id='cvv' class='form-control' placeholder='123' pattern='\d{3}'required>
                        <div class='invalid-feedback'>Required</div>
                    </div>
                </div>
                <hr class='my-4'>

                <button type='submit' class='btn btn-primary btn-lg btn-block mb-5'>Checkout</button>
            </form>
        </div>

        <script src='/js/bootstrap.min.js'></script>
        <script>
            (() => {
                'use strict'

                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                const forms = document.querySelectorAll('.needs-validation')

                // Loop over them and prevent submission
                Array.from(forms).forEach(form => {
                    form.addEventListener('submit', event => {
                        if (!form.checkValidity()) {
                            event.preventDefault()
                            event.stopPropagation()
                        } else {
                            submitCheckoutForm(event)
                        }

                        form.classList.add('was-validated')
                    }, false)
                })
            })()

            const alertPlaceholder = document.getElementById('liveAlertPlaceholder')
                const appendAlert = (message, type) => {
                    const wrapper = document.createElement('div')
                    wrapper.innerHTML = [
                        `<div class='alert alert-${type} alert-dismissible' role='alert'>`,
                        `   <div class='text-capitalize'><i class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2"></i>${message}</div>`,
                        `   <button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>`,
                        `</div>`
                    ].join('')

                    alertPlaceholder.append(wrapper)
            }

            function submitCheckoutForm(event) {
                event.preventDefault()

                const checkoutForm = event.target
                const checkoutData = new FormData(checkoutForm)
                
                fetch('api/orders/add', {
                    method: `POST`,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(Object.fromEntries(checkoutData.entries()))
                })
                    .then(response => response.json().then(body => ({status: response.status, body: body})))
                    .then(data => {
                        if (data.status == 400) {
                            for (message of data.body) {
                                    appendAlert(message, 'danger')
                            }

                            document.getElementById('cc').value= ''
                            document.getElementById('exp').value = ''
                            document.getElementById('cvv').value = ''
                        } else if (data.status == 200) {
                            window.location.href = data.body.url
                        }
                    })
                    .catch(error => {
                        console.error('Error: ', error)
                    })
            }
        </script>
    </body>
</html>
