<html>
    <head>
        <%- include('partials/navbar_shippingBracket') %>
    <style>
        .shipping-bracket {
            flex: 1; 
            display: flex;
            align-items: left;
            justify-content: left; 
            margin-right: -0.5rem;
        }

        .search-by {
            flex: 1; 
            display: flex;
            align-items: left;
            justify-content: left; 
            margin-right: -0.5rem;
        }

        .weight-brackets{
            flex: 1;
            display: flex;
            align-items: left;
            justify-content: left;
            margin-right: -0.5rem;
        }

        #query {
            height: 2.8rem;
            width: 35rem;
            background: #f5f5f5;
            outline: none;
            border: none;
            border-radius: 1.625rem;
            padding: 0 1rem;
            font-size: 1.rem;
            font-family: Arial, Helvetica, sans-serif;
        }

        .search-form {
            display: flex;
            align-items: center;
        }

        .search-button {
            width: 3.5rem;
            height: 2.8rem;
            margin-left: -3.5rem;
            background: none;
            border: none;
            outline: none;
        }
        
    </style>
        <title>Shipping Bracket Edit</title>
    </head>

    <body>
        <div class="shipping-bracket">
            <h3>Weight brackets for shipping</h3>
            <br><br>
        </div>

        <!-- Display existing shipping costs -->
        <div id="shipping-costs"></div>

        <div class="weight-brackets">
            <!-- Add form for new shipping cost -->
            <form id="add-cost-form">
                <label for="maxWeight">Weight:</label>
                <input type="number" id="maxWeight" min="0" placeholder="Enter weight" required>
                <label for="maxWeight">Cost:</label>
                <input type="text" id="cost" min="0" placeholder="Enter cost" required>
                <button type="submit">Add</button>
            </form>            

        </div>

        <script>
            function fetchAndDisplayCosts() {
                fetch('/shipping_cost/get-costs')
                    .then(response => response.json())
                    .then(costs => {
                        const shippingCostsContainer = document.getElementById('shipping-costs');
                        shippingCostsContainer.innerHTML = '';
        
                        costs.forEach(cost => {
                            const costDiv = document.createElement('div');
                            costDiv.className = 'shipping-cost';
                            costDiv.setAttribute('data-id', cost.id); 
                            costDiv.innerHTML = `<span>From ${cost.minWeight} to ${cost.maxWeight} lbs $${cost.cost}</span>`;
        
                            const removeButton = document.createElement('button');
                            removeButton.className = 'remove-button';
                            removeButton.textContent = 'Remove';
                            removeButton.addEventListener('click', () => removeCost(cost.id));
        
                            costDiv.appendChild(removeButton);
                            shippingCostsContainer.appendChild(costDiv);
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching costs:', error);
                    });
            }
        
            document.getElementById('add-cost-form').addEventListener('submit', function(event) {
                event.preventDefault();
        
                const maxWeight = document.getElementById('maxWeight').value;
                const minWeight = 0;
                const cost = document.getElementById('cost').value;
        
                // Send a POST request to add a new cost
                fetch('/shipping_cost/add-cost', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ minWeight, maxWeight, cost }),
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    console.log('new cost added');

                    // After adding a new cost, fetch and display all costs
                    fetchAndDisplayCosts();
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });
        
            // Function to remove a cost
            function removeCost(costId) {
                fetch('/shipping_cost/remove-cost', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ id: costId }),
                })
                .then(data => {
                    console.log(data);
                    console.log('Cost removed successfully');
        
                    // Fetch and display costs after removing a cost
                    fetchAndDisplayCosts();
                })
                .catch(error => {
                    console.error('Error removing cost:', error);
                });
            }
        
            // Fetch and display existing costs on page load
            window.addEventListener('load', fetchAndDisplayCosts);
        </script>
        
        
</body>

    
</html>

